ORG 0000H
JMP INIT

ORG 03H ;INTERRUPCION PARA BOTÓN ALT
JMP EXT0

ORG 0BH	;TIMER PARA DELAY
JMP TIM0

ORG 13H ;INTERRUPCION DEL TECLADO MATRICIAL
JMP EXT1

/*RENOMBRAMIENTOS*/
RS EQU P3.5
RW	EQU P3.6
E	EQU	P3.7
DBUS EQU P2
KEY EQU P0
ALT EQU P3.2
	
/*VARIABLES*/
WAIT50 EQU 40H	;BANDERA
CUENTA200 EQU 41H 
AAUX EQU 42H
ASCII EQU 43H
AAUX_2 EQU 44H

INIT:
	MOV IE, #10000111B
	MOV IP, #00000010B
	MOV TCON, #00000101B
	MOV TMOD, #10000010B
	MOV TH0, #-250
	MOV TL0, #-250
	
	MOV DPTR, #1000H
	
	ACALL DELAY_50MS		
	
	SETB E
	CLR RS
	CLR RW
	
	
	ACALL INIT_DISPLAY		
	
	

	JMP $




TIM0:	 
	 JB WAIT50, WAITING50
	 
	 WAITING50: 
	 
	 MOV A, CUENTA200
	 INC A
	 CJNE A, #0C8H, FIN
	 
	 MOV A, #00H
	 CLR WAIT50
	 
	 FIN:
	 MOV CUENTA200, A
	 RETI

EXT1:
	 MOV AAUX, A	
	 
	 MOV A, KEY			;TOMA EL NUMERO DEL TECLADO
	 JB ALT, SI_ALT	 
	 
	 NO_ALT:
		
		ACALL HEX_ASCII	;CONVIERTE EL NUMERO A ASCII
		MOV DBUS, A		;PONE EL NUMERO EN EL BUS DE DATOS	 
		ACALL ESCRIBE_DATO	;ESCRIBE EL NUMERO EN EL DISPLAY
		;CHECK_LINE
		JMP FIN_EXT1
		
	SI_ALT:
		MOV AAUX_2, A
		MOV A, ASCII
		SWAP A
		
		ANL A, #0F0H
		ORL A, AAUX_2 
		
		MOV ASCII, A		
		
	 
	FIN_EXT1:
	 MOV A, AAUX
	 RETI
	 



EXT0:
	MOV DBUS, ASCII
	ACALL ESCRIBE_DATO
	;CHECK_LINE
	MOV ASCII, #00H
	
	RETI
	

/*SUBRUTINAS*/
DELAY_50MS:
	
	SETB TR0
	SETB WAIT50
	SETB TF0	
	
	JB WAIT50, $
	CLR TR0
	RET


INIT_DISPLAY:
	MOV DBUS, #38H
	ACALL EXECUTE_E
	
	MOV DBUS, #38H
	ACALL EXECUTE_E
	
	MOV DBUS, #01H
	ACALL EXECUTE_E
	
	MOV DBUS, #0FH
	ACALL EXECUTE_E	
	
	RET


EXECUTE_E:
	CPL E
	ACALL DELAY_50MS
	CPL E
	ACALL DELAY_50MS
	RET

ESCRIBE_DATO:
	SETB RS
	ACALL EXECUTE_E
	CLR RS
	RET

HEX_ASCII:
	MOVC A, @A + DPTR
	RET



ORG 1000H
	
DB '0'
DB '1'
DB '2'
DB '3'
DB '4'
DB '5'
DB '6'
DB '7'
DB '8'
DB '9'
DB 'A'
DB 'B'
DB 'C'
DB 'D'
DB 'E'
DB 'F'
	
END